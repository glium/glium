<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Uniforms | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./tuto-04-matrices.html" />
    
    
    <link rel="prev" href="./tuto-02-triangle.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="1.3"
        data-chapter-title="Uniforms"
        data-filepath="tuto-03-animated-triangle.md"
        data-basepath="."
        data-revision="Tue Jan 16 2018 16:47:08 GMT-0800 (PST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Tutorial</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="tuto-01-getting-started.html">
            
                
                    <a href="./tuto-01-getting-started.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Opening a window
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="tuto-02-triangle.html">
            
                
                    <a href="./tuto-02-triangle.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Drawing a triangle
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.3" data-path="tuto-03-animated-triangle.html">
            
                
                    <a href="./tuto-03-animated-triangle.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Uniforms
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="tuto-04-matrices.html">
            
                
                    <a href="./tuto-04-matrices.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Matrices
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="tuto-05-colors.html">
            
                
                    <a href="./tuto-05-colors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Adding colors
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="tuto-06-texture.html">
            
                
                    <a href="./tuto-06-texture.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Adding a texture
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="tuto-07-shape.html">
            
                
                    <a href="./tuto-07-shape.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        A more complex shape
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="tuto-08-gouraud.html">
            
                
                    <a href="./tuto-08-gouraud.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Gouraud shading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="tuto-09-depth.html">
            
                
                    <a href="./tuto-09-depth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        Depth testing
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="tuto-10-perspective.html">
            
                
                    <a href="./tuto-10-perspective.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Adjusting the perspective
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="tuto-11-backface-culling.html">
            
                
                    <a href="./tuto-11-backface-culling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Backface culling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="tuto-12-camera.html">
            
                
                    <a href="./tuto-12-camera.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                        The camera and summary of the vertex processing stages
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="tuto-13-phong.html">
            
                
                    <a href="./tuto-13-phong.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.13.</b>
                        
                        Blinn-phong shading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="tuto-14-wall.html">
            
                
                    <a href="./tuto-14-wall.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.14.</b>
                        
                        Normal mapping
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
            <span><b>1.15.</b> Parallax mapping</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
            <span><b>1.16.</b> Deferred shading</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.17" >
            
            <span><b>1.17.</b> Shadow mapping</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
            <span><b>1.18.</b> Antialiasing</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.19" >
            
            <span><b>1.19.</b> Drawing lots of objects with instancing</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="perf-intro.html">
            
                
                    <a href="./perf-intro.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Performances
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="perf-sync.html">
            
                
                    <a href="./perf-sync.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Synchronization
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="animating-our-triangle">Animating our triangle</h1>
<p>Now that we have a triangle, we are going to try animating it. Remember that OpenGL is like a drawing software. If we want to make a change on the screen, we have to draw over the existing content to replace what is already there. Fortunately we already have a <code>loop</code> that continuously draws on the window, so our changes will almost instantly be reflected on the window.</p>
<h1 id="the-naive-approach">The naive approach</h1>
<p>Our first approach will be to create a variable named <code>t</code> which represents the step in the animation. We update the value of <code>t</code> at each loop, and add it to the coordinates of our triangle at each frame:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> t: <span class="hljs-keyword">f32</span> = -<span class="hljs-number">0.5</span>;
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> closed = <span class="hljs-keyword">false</span>;
<span class="hljs-keyword">while</span> !closed {
    <span class="hljs-comment">// we update `t`</span>
    t += <span class="hljs-number">0.0002</span>;
    <span class="hljs-keyword">if</span> t &gt; <span class="hljs-number">0.5</span> {
        t = -<span class="hljs-number">0.5</span>;
    }

    <span class="hljs-comment">// we create the shape an add `t` to each x coordinate</span>
    <span class="hljs-keyword">let</span> vertex1 = Vertex { position: [-<span class="hljs-number">0.5</span> + t, -<span class="hljs-number">0.5</span>] };
    <span class="hljs-keyword">let</span> vertex2 = Vertex { position: [ <span class="hljs-number">0.0</span> + t,  <span class="hljs-number">0.5</span>] };
    <span class="hljs-keyword">let</span> vertex3 = Vertex { position: [ <span class="hljs-number">0.5</span> + t, -<span class="hljs-number">0.25</span>] };
    <span class="hljs-keyword">let</span> shape = <span class="hljs-built_in">vec!</span>[vertex1, vertex2, vertex3];
    <span class="hljs-keyword">let</span> vertex_buffer = glium::VertexBuffer::new(&amp;display, &amp;shape).unwrap();

    <span class="hljs-comment">// drawing</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> target = display.draw();
    target.clear_color(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
    target.draw(&amp;vertex_buffer, &amp;indices, &amp;program, &amp;glium::uniforms::EmptyUniforms,
                &amp;Default::default()).unwrap();
    target.finish().unwrap();

    events_loop.poll_events(|event| {
        <span class="hljs-keyword">match</span> event {
            glutin::Event::WindowEvent { event, .. } =&gt; <span class="hljs-keyword">match</span> event {
                glutin::WindowEvent::Closed =&gt; closed = <span class="hljs-keyword">true</span>,
                _ =&gt; ()
            },
            _ =&gt; (),
        }
    });
}
</code></pre>
<p>If you run this code, you should see your triangle going from the left to the right of the screen, then jumping back to the left!</p>
<p>This method is approximately what game programmers were doing in the 1990s. This works perfectly fine when you have small shapes (like a single triangle), but it is highly inefficient when you manipulate models with thousands of polygons. There are two reasons for this:</p>
<ul>
<li><p>The CPU would spend a lot of time calculating the coordinates every time you draw (with one operation for each vertex for each model, at the end you reach hundreds of thousands of operations).</p>
</li>
<li><p>It takes some time to upload our shape from the RAM to the video memory. This time is totally wasted as the GPU has to wait until the transfer is finished to start its work.</p>
</li>
</ul>
<h1 id="uniforms">Uniforms</h1>
<p>Do you remember vertex shaders? Our vertex shader takes as input the attributes of each vertex, and outputs its position on the window. Instead of doing the addition in our program and upload the result, we are going to ask the GPU to do this operation.</p>
<p>Let&apos;s reset our program to what it was at the end of the first tutorial, but keep <code>t</code>:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> vertex1 = Vertex { position: [-<span class="hljs-number">0.5</span>, -<span class="hljs-number">0.5</span>] };
<span class="hljs-keyword">let</span> vertex2 = Vertex { position: [ <span class="hljs-number">0.0</span>,  <span class="hljs-number">0.5</span>] };
<span class="hljs-keyword">let</span> vertex3 = Vertex { position: [ <span class="hljs-number">0.5</span>, -<span class="hljs-number">0.25</span>] };
<span class="hljs-keyword">let</span> shape = <span class="hljs-built_in">vec!</span>[vertex1, vertex2, vertex3];

<span class="hljs-keyword">let</span> vertex_buffer = glium::VertexBuffer::new(&amp;display, &amp;shape).unwrap();

<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> t: <span class="hljs-keyword">f32</span> = -<span class="hljs-number">0.5</span>;
<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> closed = <span class="hljs-keyword">false</span>;
<span class="hljs-keyword">while</span> !closed {
    <span class="hljs-comment">// we update `t`</span>
    t += <span class="hljs-number">0.0002</span>;
    <span class="hljs-keyword">if</span> t &gt; <span class="hljs-number">0.5</span> {
        t = -<span class="hljs-number">0.5</span>;
    }

    <span class="hljs-comment">// drawing</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> target = display.draw();
    target.clear_color(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
    target.draw(&amp;vertex_buffer, &amp;indices, &amp;program, &amp;glium::uniforms::EmptyUniforms,
                &amp;Default::default()).unwrap();
    target.finish().unwrap();

    events_loop.poll_events(|event| {
        <span class="hljs-keyword">match</span> event {
            glutin::Event::WindowEvent { event, .. } =&gt; <span class="hljs-keyword">match</span> event {
                glutin::WindowEvent::Closed =&gt; closed = <span class="hljs-keyword">true</span>,
                _ =&gt; ()
            },
            _ =&gt; (),
        }
    });
}
</code></pre>
<p>And instead we are going to do a small change in our vertex shader:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> vertex_shader_src = r#<span class="hljs-string">&quot;
    #version 140

    in vec2 position;

    uniform float t;

    void main() {
        vec2 pos = position;
        pos.x += t;
        gl_Position = vec4(pos, 0.0, 1.0);
    }
&quot;</span>#;
</code></pre>
<p>You may notice that this is exactly the operation that we&apos;ve been doing above, except that this time it is done on the GPU side. We have added a variable <code>t</code> in our shader, which is declared as a <strong>uniform</strong>. A uniform is a global variable whose value is set when we draw by passing its value to the <code>draw</code> function. The easiest way to do so is to use the <code>uniform!</code> macro:</p>
<pre><code class="lang-rust">target.draw(&amp;vertex_buffer, &amp;indices, &amp;program, &amp;uniform! { t: t },
            &amp;Default::default()).unwrap();
</code></pre>
<p>Using uniform variables solves our two problems above. The CPU doesn&apos;t have to do any calculation, and all that it uploaded is the value of <code>t</code> (a single float) instead of the whole shape.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./tuto-02-triangle.html" class="navigation navigation-prev " aria-label="Previous page: Drawing a triangle"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./tuto-04-matrices.html" class="navigation navigation-next " aria-label="Next page: Matrices"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
