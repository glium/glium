<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Adjusting the perspective | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./tuto-11-backface-culling.html" />
    
    
    <link rel="prev" href="./tuto-09-depth.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="1.10"
        data-chapter-title="Adjusting the perspective"
        data-filepath="tuto-10-perspective.md"
        data-basepath="."
        data-revision="Tue Jan 16 2018 16:47:08 GMT-0800 (PST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Tutorial</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="tuto-01-getting-started.html">
            
                
                    <a href="./tuto-01-getting-started.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Opening a window
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="tuto-02-triangle.html">
            
                
                    <a href="./tuto-02-triangle.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Drawing a triangle
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="tuto-03-animated-triangle.html">
            
                
                    <a href="./tuto-03-animated-triangle.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Uniforms
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="tuto-04-matrices.html">
            
                
                    <a href="./tuto-04-matrices.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Matrices
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="tuto-05-colors.html">
            
                
                    <a href="./tuto-05-colors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Adding colors
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="tuto-06-texture.html">
            
                
                    <a href="./tuto-06-texture.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Adding a texture
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="tuto-07-shape.html">
            
                
                    <a href="./tuto-07-shape.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        A more complex shape
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="tuto-08-gouraud.html">
            
                
                    <a href="./tuto-08-gouraud.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        Gouraud shading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="tuto-09-depth.html">
            
                
                    <a href="./tuto-09-depth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                        Depth testing
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.10" data-path="tuto-10-perspective.html">
            
                
                    <a href="./tuto-10-perspective.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                        Adjusting the perspective
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="tuto-11-backface-culling.html">
            
                
                    <a href="./tuto-11-backface-culling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                        Backface culling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="tuto-12-camera.html">
            
                
                    <a href="./tuto-12-camera.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                        The camera and summary of the vertex processing stages
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="tuto-13-phong.html">
            
                
                    <a href="./tuto-13-phong.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.13.</b>
                        
                        Blinn-phong shading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="tuto-14-wall.html">
            
                
                    <a href="./tuto-14-wall.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.14.</b>
                        
                        Normal mapping
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
            <span><b>1.15.</b> Parallax mapping</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
            <span><b>1.16.</b> Deferred shading</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.17" >
            
            <span><b>1.17.</b> Shadow mapping</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
            <span><b>1.18.</b> Antialiasing</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.19" >
            
            <span><b>1.19.</b> Drawing lots of objects with instancing</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="perf-intro.html">
            
                
                    <a href="./perf-intro.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Performances
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="perf-sync.html">
            
                
                    <a href="./perf-sync.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Synchronization
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="the-perspective">The perspective</h1>
<p>The matrix that we pass to the shader when drawing our teapot contains the position, rotation
and scale of our teapot model. The third row of the fourth column, for example, holds the z
coordinate of the object. If we change it to <code>0.5</code> it will increase the z position of the
object by <code>0.5</code>.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> matrix = [
    [<span class="hljs-number">0.01</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],
    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],
    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0.0</span>],
    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0f32</span>]
];
</code></pre>
<p><em>Note: this is really the third row of the fourth column. Matrices are stored in column-major
order, meaning that we store the first column, then the second column, then the third column,
then the fourth column.</em></p>
<p>...except that there is absolutely no change and our model is still in the same position. This
works, however, if you change the x or y coordinate.</p>
<p>The reason why changing the depth of the object has no effect is that our scene doesn&apos;t have
any perspective! The depth is only used in conjunction with the depth buffer (see previous
section) and that&apos;s it. In the real life, the further an object is from the eye the smaller it
should appear.</p>
<h2 id="correcting-the-perspective">Correcting the perspective</h2>
<p>In order to make objects further away look smaller, the solution is simple: divide the x and y
coordinates by the z coordinate (multiplied by a constant). Since the coordinate <code>(0, 0)</code> is
at the center of the screen, objects that are far away will look like they are more towards
the center of the screen, which is the <a href="https://en.wikipedia.org/wiki/Vanishing_point" target="_blank">vanishing point</a>.</p>
<p>But it is not possible with simple matrix multiplications to divide x and y by z. This is where
the fourth coordinate of <code>gl_Position</code> comes into play! Instead of dividing x and y, we are
going to put the factor in the <code>w</code> coordinate. After the vertex shader is executed, the first
three coordinates will be divided by <code>w</code>.</p>
<p>Don&apos;t worry if this seem confusing. The most important thing to remember is that this fourth
coordinate exists to serve as a mathematical trick for perspective correction.</p>
<h2 id="aspect-ratio">Aspect ratio</h2>
<p>Another thing that you may have noticed is that our teapot will stretch to fill the whole window.
This is normal since the coordinates <code>-1</code> to <code>1</code> correspond to the borders of the window.</p>
<p>However in video games the scene is not stretched. Instead if you resize the window you will
notice that you will see a larger or smaller part of the scene.</p>
<p>To fix this we need to multiply the x coordinate by the height/width ratio of the screen.
We compress the objects of our scene so that when they are stretched out to match the window&apos;s
dimensions they get back to their original aspect.</p>
<h2 id="introducing-the-perspective-matrix">Introducing the perspective matrix</h2>
<p>The reason why these two problems are in the same tutorial is because graphics engines usually
solve both with one matrix: the <strong>perspective matrix</strong>.</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> perspective = {
    <span class="hljs-keyword">let</span> (width, height) = target.get_dimensions();
    <span class="hljs-keyword">let</span> aspect_ratio = height <span class="hljs-keyword">as</span> <span class="hljs-keyword">f32</span> / width <span class="hljs-keyword">as</span> <span class="hljs-keyword">f32</span>;

    <span class="hljs-keyword">let</span> fov: <span class="hljs-keyword">f32</span> = <span class="hljs-number">3.141592</span> / <span class="hljs-number">3.0</span>;
    <span class="hljs-keyword">let</span> zfar = <span class="hljs-number">1024.0</span>;
    <span class="hljs-keyword">let</span> znear = <span class="hljs-number">0.1</span>;

    <span class="hljs-keyword">let</span> f = <span class="hljs-number">1.0</span> / (fov / <span class="hljs-number">2.0</span>).tan();

    [
        [f *   aspect_ratio   ,    <span class="hljs-number">0.0</span>,              <span class="hljs-number">0.0</span>              ,   <span class="hljs-number">0.0</span>],
        [         <span class="hljs-number">0.0</span>         ,     f ,              <span class="hljs-number">0.0</span>              ,   <span class="hljs-number">0.0</span>],
        [         <span class="hljs-number">0.0</span>         ,    <span class="hljs-number">0.0</span>,  (zfar+znear)/(zfar-znear)    ,   <span class="hljs-number">1.0</span>],
        [         <span class="hljs-number">0.0</span>         ,    <span class="hljs-number">0.0</span>, -(<span class="hljs-number">2.0</span>*zfar*znear)/(zfar-znear),   <span class="hljs-number">0.0</span>],
    ]
};
</code></pre>
<p><em>Note: there are actually two different conventions: left-handed and right-handed.
For this tutorial we are using the left-handed because it doesn&apos;t invert the z coordinate.</em></p>
<p>There are four parameters used when building the matrix:</p>
<ul>
<li>The aspect ratio, which is <code>height / width</code>.</li>
<li>The <em>field of view</em> (or <em>fov</em>), which is the angle of the camera. If you have played
first person shooters, you probably know about this. There is no &quot;right&quot; value as it
depends on the user&apos;s preferences and setup. If you play on a computer you usually
need a higher fov than if you play on a television.</li>
<li><code>znear</code> and <code>zfar</code> are the minimal and maximal depth values that are within the
player&apos;s field of view. These values do not impact the visual aspect of the scene
but they can be important for the precision of the depth buffer.</li>
</ul>
<p>Don&apos;t worry if you don&apos;t understand precisely what is going on. This matrix is required to
make the scene look realistic.</p>
<p>Since we don&apos;t want to multiply our normals by our perspective matrix, we are going to
use two different matrices: the regular matrix containing the regular transformations
of our object, and the perspective matrix.</p>
<pre><code class="lang-glsl"><span class="hljs-preprocessor">#version 140</span>

<span class="hljs-keyword">in</span> <span class="hljs-keyword">vec3</span> position;
<span class="hljs-keyword">in</span> <span class="hljs-keyword">vec3</span> normal;

<span class="hljs-keyword">out</span> <span class="hljs-keyword">vec3</span> v_normal;

<span class="hljs-keyword">uniform</span> <span class="hljs-keyword">mat4</span> perspective;       <span class="hljs-comment">// new</span>
<span class="hljs-keyword">uniform</span> <span class="hljs-keyword">mat4</span> matrix;

<span class="hljs-keyword">void</span> main() {
    v_normal = <span class="hljs-built_in">transpose</span>(<span class="hljs-built_in">inverse</span>(<span class="hljs-keyword">mat3</span>(matrix))) * normal;
    <span class="hljs-built_in">gl_Position</span> = perspective * matrix * <span class="hljs-keyword">vec4</span>(position, <span class="hljs-number">1.0</span>);       <span class="hljs-comment">// new</span>
}
</code></pre>
<p>Don&apos;t forget to pass the additional uniform:</p>
<pre><code class="lang-rust">target.draw((&amp;positions, &amp;normals), &amp;indices, &amp;program,
            &amp;uniform! { matrix: matrix, perspective: perspective, u_light: light },
            &amp;params).unwrap();
</code></pre>
<p>The scene now has a correct perspective calculation! We can now move the teapot between
any value between <code>znear</code> and <code>zfar</code>. For example <code>2.0</code>:</p>
<pre><code class="lang-rust"><span class="hljs-keyword">let</span> matrix = [
    [<span class="hljs-number">0.01</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],
    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],
    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0.0</span>],
    [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">1.0f32</span>]
];
</code></pre>
<p>And here is the result:</p>
<p><img src="tuto-10-result.png" alt="Result"></p>
<p>Also note that the object keeps its regular look even when we resize the dimension and is no
longer stretched.</p>
<p>If you compare this to the previous screenshot, you can also see how the teapot now looks
much better.</p>
<p><strong><a href="https://github.com/glium/glium/blob/master/examples/tutorial-10.rs" target="_blank">You can find the entire source code here</a>.</strong></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./tuto-09-depth.html" class="navigation navigation-prev " aria-label="Previous page: Depth testing"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./tuto-11-backface-culling.html" class="navigation navigation-next " aria-label="Next page: Backface culling"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
