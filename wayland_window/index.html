<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `wayland_window` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, wayland_window">

    <title>wayland_window - Rust</title>

    <link rel="stylesheet" type="text/css" href="../normalize.css">
    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Crate wayland_window</p><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'wayland_window', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Crate <a class="mod" href=''>wayland_window</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../src/wayland_window/lib.rs.html#1-275' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Wayland Window, a minimalistic decoration-drawing library for
wayland applications.</p>

<p>This crate is only usable in conjuction of the
<a href="https://crates.io/crates/wayland-client"><code>wayland-client</code></a> crate.</p>

<h2 id='creating-a-window-with-decorations' class='section-header'><a href='#creating-a-window-with-decorations'>Creating a window with decorations</a></h2>
<p>Creating a decorated frame for your window is simply done using the provided init function:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><pre class="rust rust-example-rendered ignore">
<span class="kw">use</span> <span class="ident">wayland_window</span>::<span class="ident">create_frame</span>;
<span class="comment">// if using the legacy wl_shell global</span>
<span class="kw">let</span> <span class="ident">shell</span> <span class="op">=</span> <span class="ident">Shell</span>::<span class="ident">Wl</span>(<span class="ident">my_wl_shell</span>);
<span class="comment">// if using the new not-yet-stable xdg_shell</span>
<span class="kw">let</span> <span class="ident">shell</span> <span class="op">=</span> <span class="ident">Shell</span>::<span class="ident">Xdg</span>(<span class="ident">my_xdh_shell</span>);
<span class="kw">let</span> <span class="ident">frame</span> <span class="op">=</span> <span class="ident">create_frame</span>(
       <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">event_queue</span>, <span class="ident">my_implementation</span>, <span class="ident">my_implementation_data</span>,
       <span class="kw-2">&amp;</span><span class="ident">my_surface</span>, <span class="ident">width</span>, <span class="ident">height</span>, <span class="kw-2">&amp;</span><span class="ident">compositor</span>, <span class="kw-2">&amp;</span><span class="ident">subcompositor</span>, <span class="kw-2">&amp;</span><span class="ident">shm</span>, <span class="kw-2">&amp;</span><span class="ident">shell</span>, <span class="prelude-val">Some</span>(<span class="ident">seat</span>)
).<span class="ident">unwrap</span>(); <span class="comment">// creation can fail</span></pre>

<p>As you can see, you need to pass several references to global objects as well as a <code>WlSeat</code>.
It is required for the library to be able to create the surfaces to draw the borders, react
to user input in the borders, for resizing and move. It will use the events provided on the
seat you passed as argument. (So if you are on a setup with more than one pointer,
only the one associated with this seat will be able to resize the window).</p>

<p>See next section for example use of the <code>my_implementation</code> and
<code>my_implementation_data</code> arguments.</p>

<h2 id='configure-events' class='section-header'><a href='#configure-events'>Configure events</a></h2>
<p>The <code>Frame</code> object will not resize your window itself, as it cannot do it.</p>

<p>When the user clicks on a border and starts a resize, the server will start to generate a
number of <code>configure</code> events on the shell surface. You&#39;ll need to process the events generated
by the surface to handle them.</p>

<p>The wayland server can (and will) generate a ton of <code>configure</code> events during a single
<code>WlDisplay::dispatch()</code> if the user is currently resizing the window. You are only required to
process the last one, and if you try to handle them all your aplication will be very
laggy.</p>

<p>The proper way is to accumulate them in your subhandler, overwriting the the previous one
each time, and manually checking if one has been received in the main loop of your program.
For example like this</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">wayland_window</span>::{<span class="ident">Frame</span>, <span class="ident">create_frame</span>, <span class="ident">FrameImplementation</span>};

<span class="comment">// define a state to accumulate sizes</span>
<span class="kw">struct</span> <span class="ident">ConfigureState</span> {
    <span class="ident">new_size</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span>(<span class="ident">i32</span>,<span class="ident">i32</span>)<span class="op">&gt;</span>
}

<span class="comment">// insert it in your event queue state</span>
<span class="kw">let</span> <span class="ident">configure_token</span> <span class="op">=</span> <span class="ident">event_queue</span>.<span class="ident">state</span>().<span class="ident">insert</span>(<span class="ident">ConfigureState</span> { <span class="ident">new_size</span>: <span class="prelude-val">None</span> });

<span class="comment">// use it in your implementation:</span>
<span class="kw">let</span> <span class="ident">my_implementation</span> <span class="op">=</span> <span class="ident">FrameImplementation</span> {
    <span class="ident">configure</span>: <span class="op">|</span><span class="ident">evqh</span>, <span class="ident">token</span>, _, <span class="ident">newsize</span><span class="op">|</span> {
        <span class="kw">let</span> <span class="ident">configure_state</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">ConfigureState</span> <span class="op">=</span> <span class="ident">evqh</span>.<span class="ident">state</span>().<span class="ident">get_mut</span>(<span class="ident">token</span>);
        <span class="ident">configure_state</span>.<span class="ident">new_size</span> <span class="op">=</span> <span class="ident">newsize</span>;
    },
    <span class="ident">close</span>: <span class="op">|</span>_, _<span class="op">|</span> { <span class="comment">/* ... */</span> },
    <span class="ident">refresh</span>: <span class="op">|</span>_, _<span class="op">|</span> { <span class="comment">/* ... */</span> }
};

<span class="comment">// create the decorated surface:</span>
<span class="kw">let</span> <span class="ident">frame</span> <span class="op">=</span> <span class="ident">create_frame</span>(
    <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">event_queue</span>,          <span class="comment">// the event queue</span>
    <span class="ident">my_implementation</span>,         <span class="comment">// our implementation</span>
    <span class="ident">configure_token</span>.<span class="ident">clone</span>(),   <span class="comment">// the implementation data</span>
    <span class="kw-2">&amp;</span><span class="ident">my_surface</span>, <span class="ident">width</span>, <span class="ident">height</span>, <span class="kw-2">&amp;</span><span class="ident">compositor</span>, <span class="kw-2">&amp;</span><span class="ident">subcompositor</span>, <span class="kw-2">&amp;</span><span class="ident">shm</span>, <span class="kw-2">&amp;</span><span class="ident">shell</span>, <span class="prelude-val">Some</span>(<span class="ident">seat</span>)
).<span class="ident">unwrap</span>();

<span class="comment">// then, while running your event loop</span>
<span class="kw">loop</span> {
    <span class="ident">display</span>.<span class="ident">flush</span>().<span class="ident">unwrap</span>();
    <span class="ident">event_queue</span>.<span class="ident">dispatch</span>().<span class="ident">unwrap</span>();

    <span class="comment">// check if a resize is needed</span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">configure_state</span> <span class="op">=</span> <span class="ident">event_queue</span>.<span class="ident">state</span>().<span class="ident">get_mut</span>(<span class="kw-2">&amp;</span><span class="ident">configure_token</span>);
    <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>((<span class="ident">w</span>, <span class="ident">h</span>)) <span class="op">=</span> <span class="ident">configure_state</span>.<span class="ident">new_size</span>.<span class="ident">take</span>() {
        <span class="comment">// The compositor suggests we take a new size of (w, h)</span>
        <span class="comment">// Handle it as needed (see next section)</span>
    }
}
</pre>

<h2 id='resizing-the-surface' class='section-header'><a href='#resizing-the-surface'>Resizing the surface</a></h2>
<p>When resizing your main surface, you need to tell the <code>Frame</code> that it
must update its dimensions. This is very simple:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><pre class="rust rust-example-rendered ignore">
<span class="comment">// update your contents size (here by attaching a new buffer)</span>
<span class="ident">surface</span>.<span class="ident">attach</span>(<span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">new_buffer</span>));
<span class="ident">surface</span>.<span class="ident">commit</span>();
<span class="comment">// update the borders size</span>
<span class="ident">frame</span>.<span class="ident">resize</span>(<span class="ident">width</span>, <span class="ident">height</span>);
<span class="comment">// refresh the frame so that it actually draws the new size</span>
<span class="ident">frame</span>.<span class="ident">refresh</span>();</pre>

<p>If you do this as a response of a <code>configure</code> event, note the following points:</p>

<ul>
<li>You do not have to respect the exact sizes provided by the compositor, it is
just a hint. You can even ignore it if you don&#39;t want the window to be resized.</li>
<li>In case you chose to ignore the resize, it can be appropiate to still resize your
window to its current size (update the buffer to the compositor), as the compositer
might have resized your window without telling you.</li>
<li>The size hint provided to your implementation is a size hint for the interior of the
window: the dimensions of the border has been subtracted from the hint the compositor
gave. If you need to compute dimensions taking into account the sizes of the borders,
you can use the <code>add_borders</code> and <code>subtract_borders</code> functions.</li>
</ul>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.Frame.html"
                                  title='struct wayland_window::Frame'>Frame</a></td>
                           <td class='docblock-short'>
                                <p>A decorated frame for a window</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.FrameImplementation.html"
                                  title='struct wayland_window::FrameImplementation'>FrameImplementation</a></td>
                           <td class='docblock-short'>
                                <p>For handling events that occur to a Frame.</p>
                           </td>
                       </tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="enum" href="enum.Configure.html"
                                  title='enum wayland_window::Configure'>Configure</a></td>
                           <td class='docblock-short'>
                                <p>Configure data for a decorated surface handler.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="enum" href="enum.Shell.html"
                                  title='enum wayland_window::Shell'>Shell</a></td>
                           <td class='docblock-short'>
                                <p>Enum over the supported shells</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="enum" href="enum.State.html"
                                  title='enum wayland_window::State'>State</a></td>
                           <td class='docblock-short'>
                                <p>Possible requested state for a window</p>
                           </td>
                       </tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="fn" href="fn.add_borders.html"
                                  title='fn wayland_window::add_borders'>add_borders</a></td>
                           <td class='docblock-short'>
                                <p>Adds the border dimensions to the given dimensions.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="fn" href="fn.create_frame.html"
                                  title='fn wayland_window::create_frame'>create_frame</a></td>
                           <td class='docblock-short'>
                                <p>Create a decoration frame for a wl_surface</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="fn" href="fn.subtract_borders.html"
                                  title='fn wayland_window::subtract_borders'>subtract_borders</a></td>
                           <td class='docblock-short'>
                                <p>Subtracts the border dimensions from the given dimensions.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>↑</dt>
                    <dd>Move up in search results</dd>
                    <dt>↓</dt>
                    <dd>Move down in search results</dd>
                    <dt>↹</dt>
                    <dd>Switch tab</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt style="width:31px;">+ / -</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "wayland_window";
    </script>
    <script src="../main.js"></script>
    <script defer src="../search-index.js"></script>
</body>
</html>